import router from '@ohos.router';
import { Inspiration } from '../../model/NewDataModels';
import { InspirationDAO } from '../../database/InspirationDAO';
import { NewDatabaseManager } from '../../database/NewDatabaseManager';
import { InspirationDataInitializer } from '../../database/InspirationDataInitializer';
import { MockData } from '../../data/MockData';

// æœç´¢æ¡ä»¶æŽ¥å£
interface SearchCondition {
  id: string;
  label: string;
  type: string;
  options: SearchOption[];
  selectedValue?: string;
  selectedLabel?: string;
}

// æœç´¢é€‰é¡¹æŽ¥å£
interface SearchOption {
  label: string;
  value: string;
}

// å¿«é€Ÿç­›é€‰å™¨æŽ¥å£ï¼ˆä¿ç•™å…¼å®¹ï¼‰
interface QuickFilter {
  label: string;
  type: string;
  value: string;
}

// åˆ†ç±»å¯¼èˆªæŽ¥å£ï¼ˆä¿ç•™å…¼å®¹ï¼‰
interface Category {
  title: string;
  icon: Resource;
  items: string[];
}

@Component
export struct BrowsePage {
  @State inspirations: Inspiration[] = [];
  @State filteredInspirations: Inspiration[] = [];
  @State selectedFilters: string[] = [];
  @State searchKeyword: string = '';
  @State isLoading: boolean = true;
  
  // æ–°å¢žï¼šå¤šç»´åº¦æœç´¢çŠ¶æ€
  @State searchConditions: SearchCondition[] = [];
  @State activeDropdownId: string = '';
  @State showDropdown: boolean = false;
  
  private dbManager = new NewDatabaseManager();
  private inspirationDAO: InspirationDAO = new InspirationDAO(this.dbManager);
  private dataInitializer: InspirationDataInitializer = new InspirationDataInitializer();
  
  // çƒ­é—¨æ ‡ç­¾é…ç½®ï¼ˆæ›¿ä»£åŽŸå¿«é€Ÿç­›é€‰å™¨ï¼‰
  private hotTags: QuickFilter[] = [
    { label: 'ðŸ’ ç”Ÿæ—¥å¿…å¤‡', type: 'occasion', value: 'ç”Ÿæ—¥' },
    { label: 'â¤ï¸ æƒ…ä¾£ä¸“å±ž', type: 'audience', value: 'æ‹äºº' },
    { label: 'ðŸŽ¨ DIYæ‰‹ä½œ', type: 'type', value: 'DIYæ‰‹ä½œ' },
    { label: 'ðŸ’° ç™¾å…ƒå¥½ç¤¼', type: 'budget', value: '200' },
    { label: 'ðŸŽ‰ èŠ‚æ—¥åº†ç¥', type: 'occasion', value: 'èŠ‚æ—¥' },
    { label: 'ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦ å­æ•¬çˆ¶æ¯', type: 'audience', value: 'çˆ¶æ¯' }
  ];
  
  // åˆ†ç±»å¯¼èˆªé…ç½®ï¼ˆä¸°å¯Œæ•°æ®ï¼‰
  private categories: Category[] = [
    { 
      title: 'æŒ‰å¯¹è±¡é€', 
      icon: $r('app.media.icon_rq'),
      items: ['çˆ¶æ¯é•¿è¾ˆ', 'æ‹äººçˆ±äºº', 'é—ºèœœå¥½å‹', 'åŒäº‹é¢†å¯¼', 'å°æœ‹å‹', 'è€å¸ˆå¯¼å¸ˆ', 'å®¢æˆ·åˆä½œä¼™ä¼´', 'å…„å¼Ÿå§å¦¹', 'ç¥–çˆ¶æ¯', 'å²³çˆ¶å²³æ¯', 'æ–°æœ‹å‹', 'ç½‘å‹']
    },
    { 
      title: 'æŒ‰åœºåˆé€', 
      icon: $r('app.media.icon_ch'),
      items: ['ç”Ÿæ—¥åº†ç¥', 'ç»“å©šçºªå¿µ', 'æ‹çˆ±çºªå¿µæ—¥', 'æ¯•ä¸šå…¸ç¤¼', 'å‡èŒåŠ è–ª', 'ä¹”è¿æ–°å±…', 'æ–°ç”Ÿå„¿è¯žç”Ÿ', 'åº·å¤å‡ºé™¢', 'é“æ­‰å’Œè§£', 'æ„Ÿè°¢ç­”è°¢', 'èŠ‚æ—¥ç¥ç¦', 'å¼€ä¸šåº†å…¸']
    },
    { 
      title: 'æŒ‰å…´è¶£é€', 
      icon: $r('app.media.icon_xq'),
      items: ['ç¾Žé£Ÿçƒ¹é¥ª', 'é˜…è¯»å†™ä½œ', 'ç§‘æŠ€æ•°ç ', 'æ—…è¡Œæ‘„å½±', 'å¥èº«è¿åŠ¨', 'è‰ºæœ¯ç»˜ç”»', 'éŸ³ä¹èˆžè¹ˆ', 'æ¸¸æˆç”µç«ž', 'æ‰‹å·¥åˆ¶ä½œ', 'å›­è‰ºç§æ¤', 'æ”¶è—å¤çŽ©', 'æ—¶å°šç¾Žå¦†']
    },
    { 
      title: 'æŒ‰é¢„ç®—é€', 
      icon:  $r('app.media.icon_money'),
      items: ['50å…ƒä»¥ä¸‹', '50-100å…ƒ', '100-200å…ƒ', '200-500å…ƒ', '500-1000å…ƒ', '1000-2000å…ƒ', '2000-5000å…ƒ', '5000å…ƒä»¥ä¸Š']
    },
    { 
      title: 'æŒ‰ç±»åž‹é€', 
      icon: $r('app.media.icon_lx'),
      items: ['DIYæ‰‹ä½œ', 'ä½“éªŒæœåŠ¡', 'æ—¥ç”¨å®žç‰©', 'åˆ›æ„æ–°å¥‡', 'ç§‘æŠ€æ•°ç ', 'ç¾Žå¦†æŠ¤è‚¤', 'ä¹¦ç±æ–‡å…·', 'è¿åŠ¨æˆ·å¤–', 'å®¶å±…è£…é¥°', 'ç å®é¦–é¥°', 'æœè£…é…é¥°', 'ç¾Žé£Ÿç‰¹äº§']
    },
    {
       title: 'æŒ‰å­£èŠ‚é€',
       icon: $r('app.media.icon_rl'),
       items: ['æ˜¥å­£è¸é’', 'å¤æ—¥æ¸…å‡‰', 'ç§‹å­£æ¸©é¦¨', 'å†¬æ—¥æš–å¿ƒ', 'æƒ…äººèŠ‚', 'æ¯äº²èŠ‚', 'çˆ¶äº²èŠ‚', 'å„¿ç«¥èŠ‚', 'æ•™å¸ˆèŠ‚', 'ä¸­ç§‹èŠ‚', 'å›½åº†èŠ‚', 'åœ£è¯žèŠ‚']
     }
  ];

  aboutToAppear() {
    this.initializeSearchConditions();
    this.loadInspirations();
  }
  
  // åˆå§‹åŒ–æœç´¢æ¡ä»¶
  initializeSearchConditions() {
    this.searchConditions = [
      {
        id: 'audience',
        label: 'é€ç»™è°',
        type: 'audience',
        options: [
          { label: 'ä¸é™', value: '' },
          { label: 'çˆ¶æ¯é•¿è¾ˆ', value: 'çˆ¶æ¯' },
          { label: 'æ‹äººçˆ±äºº', value: 'æ‹äºº' },
          { label: 'é—ºèœœå¥½å‹', value: 'æœ‹å‹' },
          { label: 'åŒäº‹é¢†å¯¼', value: 'åŒäº‹' },
          { label: 'å°æœ‹å‹', value: 'å­©å­' },
          { label: 'è€å¸ˆå¯¼å¸ˆ', value: 'è€å¸ˆ' }
        ]
      },
      {
        id: 'occasion',
        label: 'ä»€ä¹ˆåœºåˆ',
        type: 'occasion',
        options: [
          { label: 'ä¸é™', value: '' },
          { label: 'ç”Ÿæ—¥åº†ç¥', value: 'ç”Ÿæ—¥' },
          { label: 'æ‹çˆ±çºªå¿µæ—¥', value: 'çºªå¿µæ—¥' },
          { label: 'èŠ‚æ—¥ç¥ç¦', value: 'èŠ‚æ—¥' },
          { label: 'æ¯•ä¸šå…¸ç¤¼', value: 'æ¯•ä¸š' },
          { label: 'å‡èŒåŠ è–ª', value: 'å‡èŒ' },
          { label: 'æ„Ÿè°¢ç­”è°¢', value: 'æ„Ÿè°¢' }
        ]
      },
      {
        id: 'budget',
        label: 'é¢„ç®—èŒƒå›´',
        type: 'budget',
        options: [
          { label: 'ä¸é™', value: '' },
          { label: '50å…ƒä»¥ä¸‹', value: '50' },
          { label: '50-100å…ƒ', value: '100' },
          { label: '100-200å…ƒ', value: '200' },
          { label: '200-500å…ƒ', value: '500' },
          { label: '500-1000å…ƒ', value: '1000' },
          { label: '1000å…ƒä»¥ä¸Š', value: '9999' }
        ]
      },
      {
        id: 'type',
        label: 'ç¤¼ç‰©ç±»åž‹',
        type: 'type',
        options: [
          { label: 'ä¸é™', value: '' },
          { label: 'DIYæ‰‹ä½œ', value: 'DIYæ‰‹ä½œ' },
          { label: 'ä½“éªŒæœåŠ¡', value: 'ä½“éªŒæœåŠ¡' },
          { label: 'æ—¥ç”¨å®žç‰©', value: 'æ—¥ç”¨å®žç‰©' },
          { label: 'åˆ›æ„æ–°å¥‡', value: 'åˆ›æ„æ–°å¥‡' },
          { label: 'ç§‘æŠ€æ•°ç ', value: 'ç§‘æŠ€æ•°ç ' },
          { label: 'ç¾Žå¦†æŠ¤è‚¤', value: 'ç¾Žå¦†æŠ¤è‚¤' }
        ]
      }
    ];
  }

  async loadInspirations() {
    try {
      this.isLoading = true;
      
      // åˆå§‹åŒ–é¢„ç½®æ•°æ®ï¼ˆå¦‚æžœéœ€è¦ï¼‰
      await this.dataInitializer.initializeAllData();
      
      this.inspirations = await this.inspirationDAO.getAllInspirations();
      
      // å¦‚æžœæ•°æ®åº“ä¸­æ²¡æœ‰æ•°æ®ï¼Œä½¿ç”¨é¢„ç½®æ•°æ®
      if (this.inspirations.length === 0) {
        this.inspirations = this.getMockInspirations();
      }
      
      this.filteredInspirations = this.inspirations;
    } catch (error) {
      console.error('åŠ è½½çµæ„Ÿæ•°æ®å¤±è´¥:', error);
      // å¦‚æžœæ•°æ®åº“ä¸ºç©ºï¼Œæ˜¾ç¤ºç¤ºä¾‹æ•°æ®
      this.inspirations = this.getMockInspirations();
      this.filteredInspirations = this.inspirations;
    } finally {
      this.isLoading = false;
    }
  }

  // èŽ·å–ç¤ºä¾‹çµæ„Ÿæ•°æ®
  getMockInspirations(): Inspiration[] {
    return MockData.getAllInspirations();
  }

  // åº”ç”¨ç­›é€‰ï¼ˆæ–°ç‰ˆæœ¬ï¼‰
  applyFilters() {
    let result = this.inspirations;
    
    // æœç´¢å…³é”®è¯ç­›é€‰
    if (this.searchKeyword.trim()) {
      const keyword = this.searchKeyword.toLowerCase();
      result = result.filter(item => 
        item.title.toLowerCase().includes(keyword) ||
        item.description.toLowerCase().includes(keyword) ||
        item.tags.some(tag => tag.toLowerCase().includes(keyword))
      );
    }
    
    // å¤šç»´åº¦æ¡ä»¶ç­›é€‰
    this.searchConditions.forEach(condition => {
      if (condition.selectedValue && condition.selectedValue !== '') {
        switch (condition.type) {
          case 'audience':
            result = result.filter(item => item.targetAudience.includes(condition.selectedValue!));
            break;
          case 'occasion':
            result = result.filter(item => item.occasions.includes(condition.selectedValue!));
            break;
          case 'budget':
            const budget = parseInt(condition.selectedValue!);
            if (budget === 9999) {
              result = result.filter(item => item.budgetRange.max >= 1000);
            } else {
              result = result.filter(item => item.budgetRange.max <= budget);
            }
            break;
          case 'type':
            result = result.filter(item => item.giftType === condition.selectedValue);
            break;
        }
      }
    });
    
    // å…¼å®¹åŽŸæœ‰çƒ­é—¨æ ‡ç­¾ç­›é€‰
    this.selectedFilters.forEach(filter => {
      const filterConfig = this.hotTags.find(f => f.label === filter);
      if (filterConfig) {
        switch (filterConfig.type) {
          case 'occasion':
            result = result.filter(item => item.occasions.includes(filterConfig.value));
            break;
          case 'audience':
            result = result.filter(item => item.targetAudience.includes(filterConfig.value));
            break;
          case 'budget':
            const budget = parseInt(filterConfig.value);
            result = result.filter(item => item.budgetRange.max <= budget);
            break;
          case 'type':
            result = result.filter(item => item.giftType === filterConfig.value);
            break;
        }
      }
    });
    
    this.filteredInspirations = result;
  }
  
  // æ˜¾ç¤º/éšè—ä¸‹æ‹‰æ¡†
  toggleDropdown(conditionId: string) {
    if (this.activeDropdownId === conditionId && this.showDropdown) {
      this.showDropdown = false;
      this.activeDropdownId = '';
    } else {
      this.activeDropdownId = conditionId;
      this.showDropdown = true;
    }
  }
  
  // é€‰æ‹©æœç´¢æ¡ä»¶
  selectSearchOption(conditionId: string, option: SearchOption) {
    const conditionIndex = this.searchConditions.findIndex(c => c.id === conditionId);
    if (conditionIndex !== -1) {
      this.searchConditions[conditionIndex].selectedValue = option.value;
      this.searchConditions[conditionIndex].selectedLabel = option.label;
    }
    this.showDropdown = false;
    this.activeDropdownId = '';
    this.applyFilters();
  }
  
  // é‡ç½®æ‰€æœ‰ç­›é€‰æ¡ä»¶
  resetAllFilters() {
    this.searchConditions.forEach(condition => {
      condition.selectedValue = '';
      condition.selectedLabel = '';
    });
    this.selectedFilters = [];
    this.searchKeyword = '';
    this.showDropdown = false;
    this.activeDropdownId = '';
    this.applyFilters();
  }

  // åˆ‡æ¢ç­›é€‰å™¨
  toggleFilter(filterLabel: string) {
    const index = this.selectedFilters.indexOf(filterLabel);
    if (index > -1) {
      this.selectedFilters.splice(index, 1);
    } else {
      this.selectedFilters.push(filterLabel);
    }
    this.applyFilters();
  }

  // å¯¼èˆªåˆ°åˆ†ç±»é¡µé¢
  navigateToCategory(category: Category) {
    try {
      // è·³è½¬åˆ°ç­›é€‰é¡µé¢ï¼Œä¼ é€’åˆ†ç±»ä¿¡æ¯
      router.pushUrl({
        url: 'pages/tabs/InspirationFilterPage',
        params: {
          filterType: 'category',
          filterValue: category.title,
          title: category.title,
          categoryItems: category.items
        }
      });
      
      console.log('å¯¼èˆªåˆ°åˆ†ç±»é¡µé¢:', category.title);
    } catch (error) {
      console.error('å¯¼èˆªå¤±è´¥:', error);
      
      // å¦‚æžœå¯¼èˆªå¤±è´¥ï¼Œåˆ™åœ¨å½“å‰é¡µé¢åº”ç”¨ç­›é€‰
      this.selectedFilters = [];
      this.searchKeyword = '';
      
      // æ ¹æ®åˆ†ç±»è®¾ç½®ç›¸åº”çš„ç­›é€‰æ¡ä»¶
      switch (category.title) {
        case 'æŒ‰å¯¹è±¡é€':
          this.selectedFilters = ['ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦ å­æ•¬çˆ¶æ¯', 'â¤ï¸ æƒ…ä¾£ä¸“å±ž'];
          break;
        case 'æŒ‰åœºåˆé€':
          this.selectedFilters = ['ðŸ’ ç”Ÿæ—¥å¿…å¤‡', 'ðŸŽ‰ èŠ‚æ—¥åº†ç¥'];
          break;
        case 'æŒ‰é¢„ç®—é€':
          this.selectedFilters = ['ðŸ’° ç™¾å…ƒå¥½ç¤¼'];
          break;
        case 'æŒ‰ç±»åž‹é€':
          this.selectedFilters = ['ðŸŽ¨ DIYæ‰‹ä½œ'];
          break;
        case 'æŒ‰å…´è¶£é€':
        case 'æŒ‰å­£èŠ‚é€':
          this.selectedFilters = ['ðŸŽ‰ èŠ‚æ—¥åº†ç¥'];
          break;
      }
      
      this.applyFilters();
      console.log('åœ¨å½“å‰é¡µé¢åº”ç”¨ç­›é€‰:', category.title, this.selectedFilters);
    }
  }

  // å¯¼èˆªåˆ°çµæ„Ÿè¯¦æƒ…é¡µ
  navigateToInspirationDetail(inspiration: Inspiration) {
    router.pushUrl({
      url: 'pages/InspirationDetailPage',
      params: {
        inspirationId: inspiration.id
      }
    });
  }

  // å¯¼èˆªåˆ°ç­›é€‰é¡µé¢
  navigateToFilter(filterType: string, filterValue: string, title?: string) {
    router.pushUrl({
      url: 'pages/tabs/InspirationFilterPage',
      params: {
        filterType: filterType,
        filterValue: filterValue,
        title: title || filterValue
      }
    });
  }

  build() {
    Stack() {
      Column() {
        // é¡¶éƒ¨æœç´¢æ 
        Row() {
          TextInput({ placeholder: 'æœç´¢çµæ„Ÿåˆ›æ„...' })
            .layoutWeight(1)
            .height(40)
            .borderRadius(20)
            .backgroundColor('#F0F0F0')
            .padding({ left: 16, right: 16 })
            .onChange((value: string) => {
              this.searchKeyword = value;
              this.applyFilters();
            })
          
          // é‡ç½®æŒ‰é’®
          Button('é‡ç½®')
            .fontSize(14)
            .height(40)
            .padding({ left: 16, right: 16 })
            .backgroundColor('#FF6B35')
            .fontColor(Color.White)
            .borderRadius(20)
            .margin({ left: 12 })
            .onClick(() => {
              this.resetAllFilters();
            })
        }
        .width('100%')
        .padding({ left: 16, right: 16, top: 12, bottom: 12 })
        .backgroundColor(Color.White)
        
        // å¤šç»´åº¦æœç´¢æ¡ä»¶æ 
        Row() {
          ForEach(this.searchConditions, (condition: SearchCondition) => {
            Button() {
              Row() {
                Text(condition.selectedLabel || condition.label)
                  .fontSize(14)
                  .fontColor(condition.selectedValue ? Color.White : '#333333')
                  .maxLines(1)
                  .textOverflow({ overflow: TextOverflow.Ellipsis })
                
                Text('â–¼')
                   .fontSize(10)
                   .fontColor(condition.selectedValue ? Color.White : '#666666')
                   .margin({ left: 4 })
              }
            }
            .layoutWeight(1)
            .height(36)
            .backgroundColor(condition.selectedValue ? '#FF6B35' : '#F8F9FA')
            .borderRadius(18)
            .margin({ right: condition.id === 'type' ? 0 : 8 })
            .onClick(() => {
              this.toggleDropdown(condition.id);
            })
          })
        }
        .width('100%')
        .padding({ left: 16, right: 16, bottom: 12 })
        .backgroundColor(Color.White)

        if (this.isLoading) {
          // åŠ è½½çŠ¶æ€
          Column() {
            LoadingProgress()
              .width(50)
              .height(50)
              .color('#FF6B35')
            
            Text('åŠ è½½ä¸­...')
              .fontSize(14)
              .fontColor('#666666')
              .margin({ top: 12 })
          }
          .width('100%')
          .height('60%')
          .justifyContent(FlexAlign.Center)
          .alignItems(HorizontalAlign.Center)
        } else {
          Scroll() {
            Column() {
              // çµæ„ŸæŽ¨èåˆ—è¡¨
              Column() {
                Row() {
                  Text('çµæ„ŸæŽ¨è')
                    .fontSize(16)
                    .fontWeight(FontWeight.Medium)
                  
                  Blank()
                  
                  Text(`å…±${this.filteredInspirations.length}ä¸ªåˆ›æ„`)
                    .fontSize(12)
                    .fontColor('#666666')
                }
                .width('100%')
                .margin({ bottom: 12 })
                
                if (this.filteredInspirations.length === 0) {
                  Column() {
                    Image($r('app.media.icon_search'))
                      .width(64)
                      .height(64)
                      .fillColor('#CCCCCC')
                      .margin({ bottom: 16 })
                    
                    Text('æš‚æ— åŒ¹é…çš„çµæ„Ÿ')
                      .fontSize(16)
                      .fontColor('#666666')
                      .margin({ bottom: 12 })
                    
                    Text('è¯•è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶æˆ–æœç´¢å…³é”®è¯')
                      .fontSize(14)
                      .fontColor('#999999')
                  }
                  .width('100%')
                  .height(200)
                  .justifyContent(FlexAlign.Center)
                  .alignItems(HorizontalAlign.Center)
                  .padding({ left: 24, right: 24 })
                } else {
                  ForEach(this.filteredInspirations, (inspiration: Inspiration) => {
                    this.buildInspirationCard(inspiration)
                  })
                }
              }
              .width('100%')
              .padding(16)
              .backgroundColor(Color.White)
            }
          }
          .layoutWeight(1)
          .scrollBar(BarState.Off)
}
      }
      .width('100%')
      .height('100%')
      .backgroundColor('#F8F9FA')
      
      // ä¸‹æ‹‰æ¡† - åœ¨æœç´¢æ¡ä»¶æ ä¸‹æ–¹å±•å¼€
      if (this.showDropdown) {
        Column() {
          // å ä½ç©ºé—´ - æœç´¢æ å’Œæ¡ä»¶æ çš„é«˜åº¦
          Column()
            .width('100%')
            .height(104) // æœç´¢æ 40+padding24 + æ¡ä»¶æ 36+padding12 = 112ï¼Œè°ƒæ•´ä¸º104
          
          // ä¸‹æ‹‰é€‰é¡¹åˆ—è¡¨
          Column() {
            ForEach(this.searchConditions.find(c => c.id === this.activeDropdownId)?.options || [], (option: SearchOption) => {
              Row() {
                Text(option.label)
                  .fontSize(16)
                  .fontColor('#333333')
                  .layoutWeight(1)
                
                if (this.searchConditions.find(c => c.id === this.activeDropdownId)?.selectedValue === option.value) {
                   Text('âœ“')
                     .fontSize(16)
                     .fontColor('#FF6B35')
                     .fontWeight(FontWeight.Bold)
                 }
              }
              .width('100%')
              .height(50)
              .padding({ left: 20, right: 20 })
              .backgroundColor(Color.White)
              .onClick(() => {
                this.selectSearchOption(this.activeDropdownId, option);
              })
              
              if (option !== (this.searchConditions.find(c => c.id === this.activeDropdownId)?.options || []).slice(-1)[0]) {
                Divider()
                  .height(1)
                  .color('#F0F0F0')
              }
            })
          }
           .width('90%')
           .height(250)
           .backgroundColor(Color.White)
           .borderRadius(8)
           .shadow({ radius: 8, color: '#1A000000', offsetX: 0, offsetY: 2 })
           .margin({ left: 16, right: 16 })
          
          // å‰©ä½™ç©ºé—´ - ç‚¹å‡»å…³é—­ä¸‹æ‹‰æ¡†
          Column()
            .width('100%')
            .layoutWeight(1)
            .onClick(() => {
              this.showDropdown = false;
              this.activeDropdownId = '';
            })
        }
        .width('100%')
        .height('100%')
        .justifyContent(FlexAlign.Start)
        .alignItems(HorizontalAlign.Start)
      }
    }
     .width('100%')
     .height('100%')
   }
   
   @Builder
  buildInspirationCard(inspiration: Inspiration) {
    Column() {
      Row() {
        Column() {
          Text(inspiration.title)
            .fontSize(16)
            .fontWeight(FontWeight.Medium)
            .fontColor('#333333')
            .maxLines(2)
            .textOverflow({ overflow: TextOverflow.Ellipsis })
            .margin({ bottom: 8 })
          
          Text(inspiration.description)
            .fontSize(14)
            .fontColor('#666666')
            .maxLines(2)
            .textOverflow({ overflow: TextOverflow.Ellipsis })
            .margin({ bottom: 12 })
          
          // æ ‡ç­¾
          Flex({ wrap: FlexWrap.Wrap, justifyContent: FlexAlign.Start }) {
            ForEach(inspiration.tags.slice(0, 3), (tag: string) => {
              Text(`#${tag}`)
                .fontSize(10)
                .fontColor('#FF6B35')
                .backgroundColor('#FFF0ED')
                .padding({ left: 6, right: 6, top: 2, bottom: 2 })
                .borderRadius(4)
                .margin({ right: 4, bottom: 4 })
            })
          }
          
          // é¢„ç®—å’Œéš¾åº¦
          Row() {
            Text(inspiration.budgetRange.label)
              .fontSize(12)
              .fontColor('#FF6B35')
              .fontWeight(FontWeight.Medium)
            
            Text('|')
              .fontSize(12)
              .fontColor('#CCCCCC')
              .margin({ left: 8, right: 8 })
            
            Text(inspiration.difficulty === 'easy' ? 'ç®€å•' : inspiration.difficulty === 'medium' ? 'ä¸­ç­‰' : 'å›°éš¾')
              .fontSize(12)
              .fontColor('#666666')
          }
          .margin({ top: 8 })
        }
        .layoutWeight(1)
        .alignItems(HorizontalAlign.Start)
        
        // ç¼©ç•¥å›¾å ä½
        Column() {
          Image($r('app.media.ic_gift_placeholder'))
                 .width(60)
                 .height(60)
        }
        .width(80)
        .height(80)
        .backgroundColor('#F0F0F0')
        .borderRadius(8)
        .justifyContent(FlexAlign.Center)
        .alignItems(HorizontalAlign.Center)
        .margin({ left: 16 }) // å¢žåŠ å·¦è¾¹è·
      }
      .width('100%')
      .alignItems(VerticalAlign.Top)
    }
    .width('100%')
    .padding(16)
    .backgroundColor(Color.White)
    .borderRadius(12)
    .margin({ bottom: 16 }) // å¢žåŠ åº•éƒ¨é—´è·
    .shadow({ radius: 4, color: '#1A000000', offsetX: 0, offsetY: 2 }) // æ·»åŠ é˜´å½±æ•ˆæžœ
    .onClick(() => {
      this.navigateToInspirationDetail(inspiration);
    })
  }
}