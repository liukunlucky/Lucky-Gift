import router from '@ohos.router';
import { Contact, Inspiration, GiftEvent } from '../../model/NewDataModels';
import { ContactDAO } from '../../database/ContactDAO';
import { InspirationDAO } from '../../database/InspirationDAO';
import { GiftEventDAO } from '../../database/GiftEventDAO';
import { NewDatabaseManager } from '../../database/NewDatabaseManager';
import fs from '@ohos.file.fs';
import picker from '@ohos.file.picker';
import { BusinessError } from '@ohos.base';

// ËèúÂçïÈ°πÊé•Âè£ÂÆö‰πâ
interface MenuItem {
  id: string;
  title: string;
  description: string;
  icon: string;
  color: string;
  count?: number;
}

interface DataMenuItem {
  id: string;
  title: string;
  description: string;
  icon: string;
  color: string;
}

interface ExportMetadata {
  totalContacts: number;
  totalEvents: number;
  totalSpent: number;
}

interface ExportData {
  version: string;
  exportDate: string;
  contacts: Contact[];
  giftEvents: GiftEvent[];
  inspirations: Inspiration[];
  metadata: ExportMetadata;
}

@Component
export struct ProfilePage {
  @State contacts: Contact[] = [];
  @State favoriteInspirations: Inspiration[] = [];
  @State totalGiftEvents: number = 0;
  @State totalSpent: number = 0;
  @State isLoading: boolean = true;
  @State showExportDialog: boolean = false;
  @State showImportDialog: boolean = false;
  @State exportProgress: number = 0;
  @State importProgress: number = 0;
  
  private dbManager = new NewDatabaseManager();
  private contactDAO: ContactDAO = new ContactDAO(this.dbManager);
  private inspirationDAO: InspirationDAO = new InspirationDAO(this.dbManager);
  private giftEventDAO: GiftEventDAO = new GiftEventDAO(this.dbManager);
  
  // ÂäüËÉΩËèúÂçïÈÖçÁΩÆ
  private menuItems: MenuItem[] = [
    {
      id: 'relationships',
      title: 'ÊàëÁöÑÂÖ≥Á≥ªÁΩëÁªú',
      description: 'ÁÆ°ÁêÜËÅîÁ≥ª‰∫∫ÂíåÈáçË¶ÅÂÖ≥Á≥ª',
      icon: 'üë•',
      color: '#4CAF50',
      count: 0
    },
    {
      id: 'favorites',
      title: 'ÊàëÁöÑÊî∂Ëóè',
      description: 'Êî∂ËóèÁöÑÁÅµÊÑüÂíåÂàõÊÑè',
      icon: '‚ù§Ô∏è',
      color: '#E91E63',
      count: 0
    },
    {
      id: 'reminders',
      title: 'Á§ºÁâ©ÊèêÈÜí',
      description: 'ÈáçË¶ÅÊó•ÊúüÊèêÈÜíËÆæÁΩÆ',
      icon: 'üîî',
      color: '#FF9800',
      count: 0
    },
    {
      id: 'statistics',
      title: 'ÈÄÅÁ§ºÁªüËÆ°',
      description: 'Êü•ÁúãÈÄÅÁ§ºÊï∞ÊçÆÂàÜÊûê',
      icon: 'üìä',
      color: '#2196F3',
      count: 0
    }
  ];
  
  // Êï∞ÊçÆÁÆ°ÁêÜËèúÂçï
  private dataMenuItems: DataMenuItem[] = [
    {
      id: 'export',
      title: 'ÂØºÂá∫Êï∞ÊçÆ',
      description: 'Â§á‰ªΩÊâÄÊúâÈÄÅÁ§ºËÆ∞ÂΩï',
      icon: 'üì§',
      color: '#9C27B0'
    },
    {
      id: 'import',
      title: 'ÂØºÂÖ•Êï∞ÊçÆ',
      description: 'ÊÅ¢Â§ç‰πãÂâçÁöÑÂ§á‰ªΩ',
      icon: 'üì•',
      color: '#607D8B'
    },
    {
      id: 'clear',
      title: 'Ê∏ÖÁ©∫Êï∞ÊçÆ',
      description: 'Âà†Èô§ÊâÄÊúâÊú¨Âú∞Êï∞ÊçÆ',
      icon: 'üóëÔ∏è',
      color: '#F44336'
    }
  ];

  aboutToAppear() {
    this.loadData();
  }

  async loadData() {
    try {
      this.isLoading = true;
      
      // Âä†ËΩΩËÅîÁ≥ª‰∫∫
      this.contacts = await this.contactDAO.getAllContacts();
      
      // Âä†ËΩΩÊî∂ËóèÁöÑÁÅµÊÑü
      this.favoriteInspirations = await this.inspirationDAO.getFavoriteInspirations();
      
      // Âä†ËΩΩÁªüËÆ°Êï∞ÊçÆ
      const stats = await this.giftEventDAO.getGiftEventStats();
      this.totalGiftEvents = stats.totalEvents;
      this.totalSpent = stats.totalSpent;
      
      // Êõ¥Êñ∞ËèúÂçïËÆ°Êï∞
      this.updateMenuCounts();
    } catch (error) {
      console.error('Âä†ËΩΩ‰∏™‰∫∫Êï∞ÊçÆÂ§±Ë¥•:', error);
    } finally {
      this.isLoading = false;
    }
  }

  // Êõ¥Êñ∞ËèúÂçïËÆ°Êï∞
  updateMenuCounts() {
    this.menuItems.forEach(item => {
      switch (item.id) {
        case 'relationships':
          item.count = this.contacts.length;
          break;
        case 'favorites':
          item.count = this.favoriteInspirations.length;
          break;
        case 'reminders':
          // ËÆ°ÁÆóÊúâÊèêÈÜíËÆæÁΩÆÁöÑËÅîÁ≥ª‰∫∫Êï∞Èáè
          item.count = this.contacts.filter(c => c.importantDates && c.importantDates.length > 0).length;
          break;
        case 'statistics':
          item.count = this.totalGiftEvents;
          break;
      }
    });
  }

  // ÂØºËà™Âà∞ÂäüËÉΩÈ°µÈù¢
  navigateToFeature(featureId: string) {
    switch (featureId) {
      case 'relationships':
        router.pushUrl({
          url: 'pages/ContactListPage'
        });
        break;
      case 'favorites':
        router.pushUrl({
          url: 'pages/FavoriteInspirationPage'
        });
        break;
      case 'reminders':
        router.pushUrl({
          url: 'pages/ReminderSettingsPage'
        });
        break;
      case 'statistics':
        router.pushUrl({
          url: 'pages/StatisticsPage'
        });
        break;
    }
  }

  navigateToFavorites() {
    router.pushUrl({
      url: 'pages/profile/FavoritesPage'
    });
  }

  // Â§ÑÁêÜÊï∞ÊçÆÁÆ°ÁêÜÊìç‰Ωú
  handleDataOperation(operationId: string) {
    switch (operationId) {
      case 'export':
        this.showExportDialog = true;
        break;
      case 'import':
        this.showImportDialog = true;
        break;
      case 'clear':
        this.showClearDataConfirmation();
        break;
    }
  }

  // ÂØºÂá∫Êï∞ÊçÆ
  async exportData() {
    try {
      this.exportProgress = 0;
      
      // Êî∂ÈõÜÊâÄÊúâÊï∞ÊçÆ
      const exportData: ExportData = {
        version: '1.0',
        exportDate: new Date().toISOString(),
        contacts: await this.contactDAO.getAllContacts(),
        giftEvents: await this.giftEventDAO.getAllGiftEvents(),
        inspirations: await this.inspirationDAO.getFavoriteInspirations(),
        metadata: {
          totalContacts: this.contacts.length,
          totalEvents: this.totalGiftEvents,
          totalSpent: this.totalSpent
        } as ExportMetadata
      };
      
      this.exportProgress = 50;
      
      // ÁîüÊàêÊñá‰ª∂Âêç
      const timestamp = new Date().toISOString().slice(0, 10);
      const fileName = `lucky_gift_backup_${timestamp}.json`;
      
      // Â∞ÜÊï∞ÊçÆËΩ¨Êç¢‰∏∫JSONÂ≠óÁ¨¶‰∏≤
      const jsonData = JSON.stringify(exportData, null, 2);
      
      this.exportProgress = 80;
      
      // ËøôÈáåÂ∫îËØ•Ë∞ÉÁî®Êñá‰ª∂‰øùÂ≠òAPIÔºåÁî±‰∫éHarmonyOSÁöÑÊñá‰ª∂APIÈôêÂà∂Ôºå
      // ÂÆûÈôÖÂÆûÁé∞ÂèØËÉΩÈúÄË¶Å‰ΩøÁî®picker.save()ÊàñÂÖ∂‰ªñÊñπÂºè
      console.log('ÂØºÂá∫Êï∞ÊçÆ:', fileName, jsonData.length, 'Â≠óÁ¨¶');
      
      this.exportProgress = 100;
      
      // ÊòæÁ§∫ÊàêÂäüÊ∂àÊÅØ
      setTimeout(() => {
        this.showExportDialog = false;
        this.exportProgress = 0;
      }, 1000);
      
    } catch (error) {
      console.error('ÂØºÂá∫Êï∞ÊçÆÂ§±Ë¥•:', error);
      this.showExportDialog = false;
      this.exportProgress = 0;
    }
  }

  // ÂØºÂÖ•Êï∞ÊçÆ
  async importData() {
    try {
      this.importProgress = 0;
      
      // ËøôÈáåÂ∫îËØ•‰ΩøÁî®Êñá‰ª∂ÈÄâÊã©Âô®ÈÄâÊã©Â§á‰ªΩÊñá‰ª∂
      // Áî±‰∫éAPIÈôêÂà∂ÔºåËøôÈáåÂè™ÊòØÁ§∫‰æã‰ª£Á†Å
      
      this.importProgress = 30;
      
      // Ëß£ÊûêJSONÊï∞ÊçÆ
      // const importData = JSON.parse(fileContent);
      
      this.importProgress = 60;
      
      // ÂØºÂÖ•ËÅîÁ≥ª‰∫∫
      // await this.contactDAO.importContacts(importData.contacts);
      
      // ÂØºÂÖ•Á§ºÁâ©‰∫ã‰ª∂
      // await this.giftEventDAO.importGiftEvents(importData.giftEvents);
      
      // ÂØºÂÖ•Êî∂ËóèÁöÑÁÅµÊÑü
      // await this.inspirationDAO.importFavorites(importData.inspirations);
      
      this.importProgress = 90;
      
      // ÈáçÊñ∞Âä†ËΩΩÊï∞ÊçÆ
      await this.loadData();
      
      this.importProgress = 100;
      
      setTimeout(() => {
        this.showImportDialog = false;
        this.importProgress = 0;
      }, 1000);
      
    } catch (error) {
      console.error('ÂØºÂÖ•Êï∞ÊçÆÂ§±Ë¥•:', error);
      this.showImportDialog = false;
      this.importProgress = 0;
    }
  }

  // ÊòæÁ§∫Ê∏ÖÁ©∫Êï∞ÊçÆÁ°ÆËÆ§ÂØπËØùÊ°Ü
  showClearDataConfirmation() {
    AlertDialog.show({
      title: 'Á°ÆËÆ§Ê∏ÖÁ©∫Êï∞ÊçÆ',
      message: 'Ê≠§Êìç‰ΩúÂ∞ÜÂà†Èô§ÊâÄÊúâÊú¨Âú∞Êï∞ÊçÆÔºåÂåÖÊã¨ËÅîÁ≥ª‰∫∫„ÄÅÁ§ºÁâ©ËÆ∞ÂΩïÂíåÊî∂ËóèÁöÑÁÅµÊÑü„ÄÇÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºåËØ∑Á°ÆËÆ§ÊòØÂê¶ÁªßÁª≠Ôºü',
      primaryButton: {
        value: 'ÂèñÊ∂à',
        action: () => {}
      },
      secondaryButton: {
        value: 'Á°ÆËÆ§Ê∏ÖÁ©∫',
        fontColor: '#FF4444',
        action: () => {
          this.clearAllData();
        }
      }
    });
  }

  // Ê∏ÖÁ©∫ÊâÄÊúâÊï∞ÊçÆ
  async clearAllData() {
    try {
      // Ê∏ÖÁ©∫ÊâÄÊúâË°®ÁöÑÊï∞ÊçÆ
      await this.dbManager.clearAllData();
      
      // ÈáçÊñ∞Âä†ËΩΩÊï∞ÊçÆ
      await this.loadData();
      
      // ÊòæÁ§∫ÊàêÂäüÊ∂àÊÅØ
      AlertDialog.show({
        title: 'Ê∏ÖÁ©∫ÂÆåÊàê',
        message: 'ÊâÄÊúâÊï∞ÊçÆÂ∑≤ÊàêÂäüÊ∏ÖÁ©∫„ÄÇ',
        primaryButton: {
          value: 'Á°ÆÂÆö',
          action: () => {}
        }
      });
    } catch (error) {
      console.error('Ê∏ÖÁ©∫Êï∞ÊçÆÂ§±Ë¥•:', error);
      AlertDialog.show({
        title: 'Ê∏ÖÁ©∫Â§±Ë¥•',
        message: 'Ê∏ÖÁ©∫Êï∞ÊçÆÊó∂ÂèëÁîüÈîôËØØÔºåËØ∑ÈáçËØï„ÄÇ',
        primaryButton: {
          value: 'Á°ÆÂÆö',
          action: () => {}
        }
      });
    }
  }

  // Ê†ºÂºèÂåñÈáëÈ¢ù
  formatAmount(amount: number): string {
    if (amount >= 10000) {
      return `${(amount / 10000).toFixed(1)}‰∏á`;
    } else if (amount >= 1000) {
      return `${(amount / 1000).toFixed(1)}k`;
    }
    return amount.toString();
  }

  build() {
    Column() {
      // È°∂ÈÉ®‰∏™‰∫∫‰ø°ÊÅØÂç°Áâá
      Column() {
        Row() {
          // Â§¥ÂÉè
          Image($r('app.media.ic_mine'))
            .width(60)
            .height(60)
            .borderRadius(30)
            .backgroundColor('#F0F0F0')
          
          Column() {
            Text('ÊàëÁöÑÈÄÅÁ§ºÊô∫Â∫ì')
              .fontSize(18)
              .fontWeight(FontWeight.Bold)
              .fontColor(Color.White)
            
            Text('ËÆ∞ÂΩïÊØè‰∏Ä‰ªΩÂøÉÊÑè')
              .fontSize(14)
              .fontColor('#FFE0D6')
              .margin({ top: 4 })
          }
          .alignItems(HorizontalAlign.Start)
          .margin({ left: 16 })
          
          Blank()
        }
        .width('100%')
        .margin({ bottom: 20 })
        
        // ÁªüËÆ°Êï∞ÊçÆ
        Row() {
          Column() {
            Text(this.contacts.length.toString())
              .fontSize(20)
              .fontWeight(FontWeight.Bold)
              .fontColor(Color.White)
            
            Text('ËÅîÁ≥ª‰∫∫')
              .fontSize(12)
              .fontColor('#FFE0D6')
              .margin({ top: 2 })
          }
          .layoutWeight(1)
          
          Column() {
            Text(this.totalGiftEvents.toString())
              .fontSize(20)
              .fontWeight(FontWeight.Bold)
              .fontColor(Color.White)
            
            Text('ÈÄÅÁ§ºËÆ∞ÂΩï')
              .fontSize(12)
              .fontColor('#FFE0D6')
              .margin({ top: 2 })
          }
          .layoutWeight(1)
          
          Column() {
            Text(`¬•${this.formatAmount(this.totalSpent)}`)
              .fontSize(20)
              .fontWeight(FontWeight.Bold)
              .fontColor(Color.White)
            
            Text('ÊÄªËä±Ë¥π')
              .fontSize(12)
              .fontColor('#FFE0D6')
              .margin({ top: 2 })
          }
          .layoutWeight(1)
          
          Column() {
            Text(this.favoriteInspirations.length.toString())
              .fontSize(20)
              .fontWeight(FontWeight.Bold)
              .fontColor(Color.White)
            
            Text('Êî∂ËóèÁÅµÊÑü')
              .fontSize(12)
              .fontColor('#FFE0D6')
              .margin({ top: 2 })
          }
          .layoutWeight(1)
        }
        .width('100%')
      }
      .width('100%')
      .padding(20)
      .backgroundColor('#FF6B35')
      .borderRadius({ bottomLeft: 20, bottomRight: 20 })

      if (this.isLoading) {
        // Âä†ËΩΩÁä∂ÊÄÅ
        Column() {
          LoadingProgress()
            .width(50)
            .height(50)
            .color('#FF6B35')
          
          Text('Âä†ËΩΩ‰∏≠...')
            .fontSize(14)
            .fontColor('#666666')
            .margin({ top: 12 })
        }
        .width('100%')
        .height('60%')
        .justifyContent(FlexAlign.Center)
        .alignItems(HorizontalAlign.Center)
      } else {
        Scroll() {
          Column() {
            // ÂäüËÉΩËèúÂçï
            Column() {
              Text('ÊàëÁöÑÂäüËÉΩ')
                .fontSize(16)
                .fontWeight(FontWeight.Medium)
                .margin({ bottom: 16 })
                .alignSelf(ItemAlign.Start)
              
              ForEach(this.menuItems, (item: MenuItem) => {
                Row() {
                  Row() {
                    Text(item.icon)
                      .fontSize(24)
                      .margin({ right: 12 })
                    
                    Column() {
                      Text(item.title)
                        .fontSize(15)
                        .fontWeight(FontWeight.Medium)
                        .fontColor('#333333')
                      
                      Text(item.description)
                        .fontSize(12)
                        .fontColor('#666666')
                        .margin({ top: 2 })
                    }
                    .alignItems(HorizontalAlign.Start)
                  }
                  .layoutWeight(1)
                  
                  Row() {
                    if (item.count !== undefined && item.count > 0) {
                      Text(item.count.toString())
                        .fontSize(14)
                        .fontColor('#666666')
                        .margin({ right: 8 })
                    }
                    
                    Image($r('app.media.ic_arrow_right'))
                      .width(16)
                      .height(16)
                      .fillColor('#CCCCCC')
                  }
                }
                .width('100%')
                .height(60)
                .padding({ left: 16, right: 16 })
                .backgroundColor(Color.White)
                .borderRadius(12)
                .margin({ bottom: 8 })
                .onClick(() => {
                  this.navigateToFeature(item.id);
                })
              })
            }
            .width('100%')
            .padding(16)
            .margin({ top: 8 })

            // Êï∞ÊçÆÁÆ°ÁêÜ
            Column() {
              Text('Êï∞ÊçÆÁÆ°ÁêÜ')
                .fontSize(16)
                .fontWeight(FontWeight.Medium)
                .margin({ bottom: 16 })
                .alignSelf(ItemAlign.Start)
              
              ForEach(this.dataMenuItems, (item: DataMenuItem) => {
                Row() {
                  Row() {
                    Text(item.icon)
                      .fontSize(24)
                      .margin({ right: 12 })
                    
                    Column() {
                      Text(item.title)
                        .fontSize(15)
                        .fontWeight(FontWeight.Medium)
                        .fontColor('#333333')
                      
                      Text(item.description)
                        .fontSize(12)
                        .fontColor('#666666')
                        .margin({ top: 2 })
                    }
                    .alignItems(HorizontalAlign.Start)
                  }
                  .layoutWeight(1)
                  
                  Image($r('app.media.ic_arrow_right'))
                    .width(16)
                    .height(16)
                    .fillColor('#CCCCCC')
                }
                .width('100%')
                .height(60)
                .padding({ left: 16, right: 16 })
                .backgroundColor(Color.White)
                .borderRadius(12)
                .margin({ bottom: 8 })
                .onClick(() => {
                  this.handleDataOperation(item.id);
                })
              })
            }
            .width('100%')
            .padding(16)

            // ÊúÄËøëËÅîÁ≥ª‰∫∫
            if (this.contacts.length > 0) {
              Column() {
                Row() {
                  Text('ÊúÄËøëËÅîÁ≥ª‰∫∫')
                    .fontSize(16)
                    .fontWeight(FontWeight.Medium)
                  
                  Blank()
                  
                  Text('Êü•ÁúãÂÖ®ÈÉ®')
                    .fontSize(12)
                    .fontColor('#FF6B35')
                    .onClick(() => {
                      this.navigateToFeature('relationships');
                    })
                }
                .width('100%')
                .margin({ bottom: 16 })
                
                Row() {
                  ForEach(this.contacts.slice(0, 4), (contact: Contact) => {
                    Column() {
                      Text(contact.avatar || 'üë§')
                        .fontSize(30)
                        .width(50)
                        .height(50)
                        .borderRadius(25)
                        .backgroundColor('#F0F0F0')
                        .textAlign(TextAlign.Center)
                        .backgroundColor('#F0F0F0')
                      
                      Text(contact.name)
                        .fontSize(12)
                        .fontColor('#333333')
                        .margin({ top: 6 })
                        .maxLines(1)
                        .textOverflow({ overflow: TextOverflow.Ellipsis })
                    }
                    .width(60)
                    .margin({ right: 12 })
                    .onClick(() => {
                      router.pushUrl({
                        url: 'pages/profile/ContactDetailPage',
                        params: { contactId: contact.id }
                      });
                    })
                  })
                }
                .width('100%')
              }
              .width('100%')
              .padding(16)
              .backgroundColor(Color.White)
              .borderRadius(12)
              .margin({ bottom: 20 })
            }
          }
        }
        .layoutWeight(1)
        .scrollBar(BarState.Off)
      }
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#F8F9FA')
    .bindSheet($$this.showExportDialog, this.buildExportDialog(), {
      height: 300,
      dragBar: true
    })
    .bindSheet($$this.showImportDialog, this.buildImportDialog(), {
      height: 300,
      dragBar: true
    })
  }

  @Builder
  buildExportDialog() {
    Column() {
      Text('ÂØºÂá∫Êï∞ÊçÆ')
        .fontSize(18)
        .fontWeight(FontWeight.Medium)
        .margin({ bottom: 24 })
      
      if (this.exportProgress === 0) {
        Column() {
          Text('Âç≥Â∞ÜÂØºÂá∫‰ª•‰∏ãÊï∞ÊçÆÔºö')
            .fontSize(14)
            .fontColor('#333333')
            .margin({ bottom: 16 })
          
          Column() {
            Text(`‚Ä¢ ${this.contacts.length} ‰∏™ËÅîÁ≥ª‰∫∫`)
              .fontSize(14)
              .fontColor('#666666')
              .alignSelf(ItemAlign.Start)
              .margin({ bottom: 4 })
            
            Text(`‚Ä¢ ${this.totalGiftEvents} Êù°ÈÄÅÁ§ºËÆ∞ÂΩï`)
              .fontSize(14)
              .fontColor('#666666')
              .alignSelf(ItemAlign.Start)
              .margin({ bottom: 4 })
            
            Text(`‚Ä¢ ${this.favoriteInspirations.length} ‰∏™Êî∂ËóèÁöÑÁÅµÊÑü`)
              .fontSize(14)
              .fontColor('#666666')
              .alignSelf(ItemAlign.Start)
          }
          .width('100%')
          .margin({ bottom: 24 })
          
          Row() {
            Button('ÂèñÊ∂à')
              .layoutWeight(1)
              .height(44)
              .backgroundColor('#F0F0F0')
              .fontColor('#333333')
              .borderRadius(22)
              .margin({ right: 8 })
              .onClick(() => {
                this.showExportDialog = false;
              })
            
            Button('ÂºÄÂßãÂØºÂá∫')
              .layoutWeight(1)
              .height(44)
              .backgroundColor('#FF6B35')
              .fontColor(Color.White)
              .borderRadius(22)
              .margin({ left: 8 })
              .onClick(() => {
                this.exportData();
              })
          }
          .width('100%')
        }
      } else {
        Column() {
          Text('Ê≠£Âú®ÂØºÂá∫Êï∞ÊçÆ...')
            .fontSize(14)
            .fontColor('#333333')
            .margin({ bottom: 16 })
          
          Progress({ value: this.exportProgress, total: 100, type: ProgressType.Linear })
            .width('100%')
            .color('#FF6B35')
            .backgroundColor('#F0F0F0')
            .margin({ bottom: 16 })
          
          Text(`${this.exportProgress}%`)
            .fontSize(14)
            .fontColor('#666666')
        }
        .width('100%')
      }
    }
    .width('100%')
    .padding(24)
  }

  @Builder
  buildImportDialog() {
    Column() {
      Text('ÂØºÂÖ•Êï∞ÊçÆ')
        .fontSize(18)
        .fontWeight(FontWeight.Medium)
        .margin({ bottom: 24 })
      
      if (this.importProgress === 0) {
        Column() {
          Text('ÈÄâÊã©Ë¶ÅÂØºÂÖ•ÁöÑÂ§á‰ªΩÊñá‰ª∂')
            .fontSize(14)
            .fontColor('#333333')
            .margin({ bottom: 16 })
          
          Text('‚ö†Ô∏è ÂØºÂÖ•Êï∞ÊçÆÂ∞ÜË¶ÜÁõñÂΩìÂâçÊâÄÊúâÊï∞ÊçÆÔºåËØ∑Á°Æ‰øùÂ∑≤Â§á‰ªΩÈáçË¶Å‰ø°ÊÅØ„ÄÇ')
            .fontSize(12)
            .fontColor('#FF6B35')
            .backgroundColor('#FFF0ED')
            .padding(12)
            .borderRadius(8)
            .margin({ bottom: 24 })
          
          Row() {
            Button('ÂèñÊ∂à')
              .layoutWeight(1)
              .height(44)
              .backgroundColor('#F0F0F0')
              .fontColor('#333333')
              .borderRadius(22)
              .margin({ right: 8 })
              .onClick(() => {
                this.showImportDialog = false;
              })
            
            Button('ÈÄâÊã©Êñá‰ª∂')
              .layoutWeight(1)
              .height(44)
              .backgroundColor('#FF6B35')
              .fontColor(Color.White)
              .borderRadius(22)
              .margin({ left: 8 })
              .onClick(() => {
                this.importData();
              })
          }
          .width('100%')
        }
      } else {
        Column() {
          Text('Ê≠£Âú®ÂØºÂÖ•Êï∞ÊçÆ...')
            .fontSize(14)
            .fontColor('#333333')
            .margin({ bottom: 16 })
          
          Progress({ value: this.importProgress, total: 100, type: ProgressType.Linear })
            .width('100%')
            .color('#FF6B35')
            .backgroundColor('#F0F0F0')
            .margin({ bottom: 16 })
          
          Text(`${this.importProgress}%`)
            .fontSize(14)
            .fontColor('#666666')
        }
        .width('100%')
      }
    }
    .width('100%')
    .padding(24)
  }
}