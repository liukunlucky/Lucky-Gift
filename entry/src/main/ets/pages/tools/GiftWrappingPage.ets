import router from '@ohos.router';

interface WrappingStyle {
  id: number;
  name: string;
  description: string;
  difficulty: string;
  materials: string[];
  steps: string[];
  imageUrl: string;
  category: string;
}

@Entry
@Component
struct GiftWrappingPage {
  @State selectedCategory: string = 'å…¨éƒ¨';
  @State wrappingStyles: WrappingStyle[] = [];
  @State categories: string[] = ['å…¨éƒ¨', 'ç®€çº¦é£', 'å¯çˆ±é£', 'å•†åŠ¡é£', 'èŠ‚æ—¥é£', 'åˆ›æ„é£'];

  aboutToAppear() {
    this.loadWrappingStyles();
  }

  // åŠ è½½åŒ…è£…æ ·å¼æ•°æ®
  loadWrappingStyles() {
    this.wrappingStyles = [
      {
        id: 1,
        name: 'ç»å…¸è´è¶ç»“åŒ…è£…',
        description: 'ä¼˜é›…çš„è´è¶ç»“åŒ…è£…ï¼Œé€‚åˆå„ç§åœºåˆ',
        difficulty: 'ç®€å•',
        materials: ['åŒ…è£…çº¸', 'ä¸å¸¦', 'åŒé¢èƒ¶', 'å‰ªåˆ€'],
        steps: [
          'å°†ç¤¼å“æ”¾åœ¨åŒ…è£…çº¸ä¸­å¤®',
          'å°†åŒ…è£…çº¸å¯¹æŠ˜åŒ…è£¹ç¤¼å“',
          'ç”¨åŒé¢èƒ¶å›ºå®šåŒ…è£…çº¸',
          'åœ¨é¡¶éƒ¨ç³»ä¸Šè´è¶ç»“'
        ],
        imageUrl: '',
        category: 'ç®€çº¦é£'
      },
      {
        id: 2,
        name: 'æ—¥å¼é£å‘‚æ•·åŒ…è£…',
        description: 'ä¼ ç»Ÿæ—¥å¼åŒ…è£…æ–¹æ³•ï¼Œç¯ä¿åˆç¾è§‚',
        difficulty: 'ä¸­ç­‰',
        materials: ['é£å‘‚æ•·å¸ƒ', 'è£…é¥°ç»³'],
        steps: [
          'å°†å¸ƒæ–™å¹³é“ºåœ¨æ¡Œé¢',
          'å°†ç¤¼å“æ”¾åœ¨å¸ƒæ–™ä¸­å¤®',
          'å°†å¯¹è§’çš„å¸ƒæ–™æ‰“ç»“',
          'è°ƒæ•´å¸ƒæ–™å½¢çŠ¶'
        ],
        imageUrl: '',
        category: 'åˆ›æ„é£'
      },
      {
        id: 3,
        name: 'èŠ±æŸå¼åŒ…è£…',
        description: 'åƒèŠ±æŸä¸€æ ·çš„åŒ…è£…æ–¹å¼ï¼Œæµªæ¼«æ¸©é¦¨',
        difficulty: 'ä¸­ç­‰',
        materials: ['é€æ˜åŒ…è£…çº¸', 'å½©å¸¦', 'è£…é¥°èŠ±', 'èƒ¶å¸¦'],
        steps: [
          'ç”¨é€æ˜çº¸åŒ…è£¹ç¤¼å“',
          'åœ¨é¡¶éƒ¨æ”¶ç´§å½¢æˆèŠ±æŸçŠ¶',
          'ç”¨å½©å¸¦ç»‘ç´§',
          'æ·»åŠ è£…é¥°èŠ±'
        ],
        imageUrl: '',
        category: 'å¯çˆ±é£'
      },
      {
        id: 4,
        name: 'å•†åŠ¡ç¤¼ç›’åŒ…è£…',
        description: 'æ­£å¼çš„å•†åŠ¡åŒ…è£…ï¼Œé€‚åˆå•†åŠ¡åœºåˆ',
        difficulty: 'ç®€å•',
        materials: ['ç¤¼ç›’', 'ç¼å¸¦', 'è´ºå¡', 'å°èœ¡'],
        steps: [
          'å°†ç¤¼å“æ”¾å…¥ç¤¼ç›’',
          'ç›–ä¸Šç›’ç›–',
          'ç”¨ç¼å¸¦è£…é¥°',
          'è´´ä¸Šè´ºå¡'
        ],
        imageUrl: '',
        category: 'å•†åŠ¡é£'
      },
      {
        id: 5,
        name: 'åœ£è¯ä¸»é¢˜åŒ…è£…',
        description: 'å……æ»¡èŠ‚æ—¥æ°”æ°›çš„åœ£è¯åŒ…è£…',
        difficulty: 'ä¸­ç­‰',
        materials: ['çº¢è‰²åŒ…è£…çº¸', 'é‡‘è‰²ä¸å¸¦', 'åœ£è¯è£…é¥°', 'é“ƒé“›'],
        steps: [
          'ç”¨çº¢è‰²åŒ…è£…çº¸åŒ…è£¹',
          'ç³»ä¸Šé‡‘è‰²ä¸å¸¦',
          'æ·»åŠ åœ£è¯è£…é¥°',
          'æŒ‚ä¸Šå°é“ƒé“›'
        ],
        imageUrl: '',
        category: 'èŠ‚æ—¥é£'
      }
    ];
  }

  // è·å–è¿‡æ»¤åçš„åŒ…è£…æ ·å¼
  getFilteredStyles(): WrappingStyle[] {
    if (this.selectedCategory === 'å…¨éƒ¨') {
      return this.wrappingStyles;
    }
    return this.wrappingStyles.filter(style => style.category === this.selectedCategory);
  }

  // è¿”å›ä¸Šä¸€é¡µ
  goBack() {
    router.back();
  }

  build() {
    Column() {
      // é¡¶éƒ¨å¯¼èˆªæ 
      Row() {
        Button() {
          Text('â†')
            .fontSize(20)
            .fontColor('#333333')
        }
        .width(40)
        .height(40)
        .backgroundColor(Color.Transparent)
        .onClick(() => this.goBack())
        
        Text('ç¤¼ç‰©åŒ…è£…')
          .fontSize(18)
          .fontWeight(FontWeight.Medium)
          .fontColor('#333333')
          .layoutWeight(1)
          .textAlign(TextAlign.Center)
        
        Row().width(40) // å ä½
      }
      .width('100%')
      .height(56)
      .padding({ left: 16, right: 16 })
      .backgroundColor('#FFFFFF')
      .border({ width: { bottom: 1 }, color: '#F0F0F0' })

      // åˆ†ç±»é€‰æ‹©
      Row() {
        List({ space: 8 }) {
          ForEach(this.categories, (category: string) => {
            ListItem() {
              Text(category)
                .fontSize(14)
                .fontColor(this.selectedCategory === category ? '#FFFFFF' : '#666666')
                .backgroundColor(this.selectedCategory === category ? '#FF6B35' : '#F8F9FA')
                .borderRadius(16)
                .padding({ left: 16, right: 16, top: 8, bottom: 8 })
                .onClick(() => {
                  this.selectedCategory = category;
                })
            }
          }, (category: string) => category)
        }
        .listDirection(Axis.Horizontal)
        .scrollBar(BarState.Off)
      }
      .width('100%')
      .padding(16)
      .backgroundColor('#FFFFFF')
      .border({ width: { bottom: 1 }, color: '#F0F0F0' })

      // åŒ…è£…æ ·å¼åˆ—è¡¨
      List() {
        ForEach(this.getFilteredStyles(), (style: WrappingStyle) => {
          ListItem() {
            Column() {
              // æ ·å¼å›¾ç‰‡å ä½
              Column() {
                Text('ğŸ')
                  .fontSize(48)
              }
              .width('100%')
              .height(120)
              .backgroundColor('#F8F9FA')
              .borderRadius(8)
              .justifyContent(FlexAlign.Center)
              
              // æ ·å¼ä¿¡æ¯
              Column() {
                Row() {
                  Text(style.name)
                    .fontSize(16)
                    .fontWeight(FontWeight.Medium)
                    .fontColor('#333333')
                    .layoutWeight(1)
                  
                  Text(style.difficulty)
                    .fontSize(12)
                    .fontColor('#FFFFFF')
                    .backgroundColor(style.difficulty === 'ç®€å•' ? '#4CAF50' : '#FF9800')
                    .borderRadius(4)
                    .padding({ left: 6, right: 6, top: 2, bottom: 2 })
                }
                .width('100%')
                .margin({ top: 12 })
                
                Text(style.description)
                  .fontSize(14)
                  .fontColor('#666666')
                  .margin({ top: 4 })
                  .maxLines(2)
                  .textOverflow({ overflow: TextOverflow.Ellipsis })
                
                // æ‰€éœ€ææ–™
                Column() {
                  Text('æ‰€éœ€ææ–™ï¼š')
                    .fontSize(12)
                    .fontColor('#999999')
                    .margin({ bottom: 4 })
                  
                  Text(style.materials.join('ã€'))
                    .fontSize(12)
                    .fontColor('#666666')
                    .maxLines(2)
                    .textOverflow({ overflow: TextOverflow.Ellipsis })
                }
                .width('100%')
                .alignItems(HorizontalAlign.Start)
                .margin({ top: 8 })
                
                // æŸ¥çœ‹è¯¦æƒ…æŒ‰é’®
                Button('æŸ¥çœ‹æ•™ç¨‹')
                  .fontSize(14)
                  .fontColor('#FF6B35')
                  .backgroundColor(Color.Transparent)
                  .border({ width: 1, color: '#FF6B35' })
                  .borderRadius(4)
                  .width('100%')
                  .height(32)
                  .margin({ top: 12 })
                  .onClick(() => {
                    this.showTutorial(style);
                  })
              }
              .width('100%')
              .padding(16)
              .alignItems(HorizontalAlign.Start)
            }
            .width('100%')
            .backgroundColor('#FFFFFF')
            .borderRadius(8)
            .margin({ bottom: 12 })
          }
        }, (style: WrappingStyle) => style.id.toString())
      }
      .width('100%')
      .layoutWeight(1)
      .padding({ left: 16, right: 16, top: 8 })
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#F8F9FA')
  }

  // æ˜¾ç¤ºæ•™ç¨‹è¯¦æƒ…
  showTutorial(style: WrappingStyle) {
    AlertDialog.show({
      title: style.name + ' æ•™ç¨‹',
      message: this.formatSteps(style.steps),
      confirm: {
        value: 'çŸ¥é“äº†',
        action: () => {}
      }
    });
  }

  // æ ¼å¼åŒ–æ­¥éª¤æ–‡æœ¬
  formatSteps(steps: string[]): string {
    let result = '';
    steps.forEach((step, index) => {
      result += `${index + 1}. ${step}\n`;
    });
    return result;
  }
}