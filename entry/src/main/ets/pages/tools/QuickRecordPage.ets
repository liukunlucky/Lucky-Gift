import router from '@ohos.router';

interface QuickRecord {
  id: string;
  type: string;
  title: string;
  content: string;
  date: string;
  tags: string[];
}

@Entry
@Component
struct QuickRecordPage {
  @State records: QuickRecord[] = [];
  @State showAddDialog: boolean = false;
  @State newRecordType: string = 'idea';
  @State newRecordTitle: string = '';
  @State newRecordContent: string = '';
  @State selectedTags: string[] = [];
  @State availableTags: string[] = ['ç¤¼ç‰©æƒ³æ³•', 'é‡è¦æ—¥æœŸ', 'é¢„ç®—è®°å½•', 'è´­ä¹°æ¸…å•', 'é€ç¤¼ç»éªŒ'];

  aboutToAppear() {
    this.loadRecords();
  }

  build() {
    Column() {
      // é¡¶éƒ¨å¯¼èˆªæ 
      Row() {
        Button() {
          Image($r('app.media.icon_back'))
            .width(24)
            .height(24)
            .fillColor('#333333')
        }
        .width(40)
        .height(40)
        .backgroundColor(Color.Transparent)
        .onClick(() => {
          router.back();
        })

        Text('ğŸ“ å¿«é€Ÿè®°å½•')
          .fontSize(18)
          .fontWeight(FontWeight.Medium)
          .fontColor('#333333')
          .layoutWeight(1)
          .textAlign(TextAlign.Center)

        Button() {
          Image($r('app.media.ic_add'))
            .width(24)
            .height(24)
            .fillColor('#FF6B35')
        }
        .width(40)
        .height(40)
        .backgroundColor(Color.Transparent)
        .onClick(() => {
          this.showAddDialog = true;
        })
      }
      .width('100%')
      .height(56)
      .padding({ left: 16, right: 16 })
      .backgroundColor(Color.White)

      // å¿«æ·æ“ä½œæŒ‰é’®
      Row() {
        this.buildQuickButton('ğŸ’¡', 'ç¤¼ç‰©æƒ³æ³•', () => {
          this.quickAdd('idea', 'ç¤¼ç‰©æƒ³æ³•');
        })
        this.buildQuickButton('ğŸ“…', 'é‡è¦æ—¥æœŸ', () => {
          this.quickAdd('date', 'é‡è¦æ—¥æœŸ');
        })
        this.buildQuickButton('ğŸ’°', 'é¢„ç®—è®°å½•', () => {
          this.quickAdd('budget', 'é¢„ç®—è®°å½•');
        })
        this.buildQuickButton('ğŸ›’', 'è´­ä¹°æ¸…å•', () => {
          this.quickAdd('shopping', 'è´­ä¹°æ¸…å•');
        })
      }
      .width('100%')
      .padding(16)
      .justifyContent(FlexAlign.SpaceAround)
      .backgroundColor(Color.White)
      .margin({ bottom: 8 })

      // è®°å½•åˆ—è¡¨
      if (this.records.length === 0) {
        Column() {
          Text('ğŸ“')
            .fontSize(48)
            .margin({ bottom: 16 })

          Text('è¿˜æ²¡æœ‰è®°å½•')
            .fontSize(16)
            .fontColor('#666666')
            .margin({ bottom: 8 })

          Text('ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹è®°å½•é€ç¤¼çµæ„Ÿ')
            .fontSize(14)
            .fontColor('#999999')
        }
        .width('100%')
        .layoutWeight(1)
        .justifyContent(FlexAlign.Center)
        .alignItems(HorizontalAlign.Center)
      } else {
        Scroll() {
          Column() {
            ForEach(this.records, (record: QuickRecord) => {
              this.buildRecordItem(record);
            })
          }
          .width('100%')
          .padding({ left: 16, right: 16 })
        }
        .layoutWeight(1)
        .backgroundColor('#F8F9FA')
      }
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#F8F9FA')
    .bindSheet($$this.showAddDialog, this.buildAddDialog(), {
      height: 600,
      showClose: true,
      dragBar: true
    })
  }

  @Builder
  buildQuickButton(icon: string, title: string, action: () => void) {
    Column() {
      Text(icon)
        .fontSize(24)
        .margin({ bottom: 8 })

      Text(title)
        .fontSize(12)
        .fontColor('#666666')
    }
    .width(80)
    .height(80)
    .justifyContent(FlexAlign.Center)
    .alignItems(HorizontalAlign.Center)
    .backgroundColor('#F8F9FA')
    .borderRadius(12)
    .onClick(action)
  }

  @Builder
  buildRecordItem(record: QuickRecord) {
    Column() {
      Row() {
        Text(this.getTypeIcon(record.type))
          .fontSize(20)
          .margin({ right: 12 })

        Column() {
          Text(record.title)
            .fontSize(16)
            .fontWeight(FontWeight.Medium)
            .fontColor('#333333')
            .alignSelf(ItemAlign.Start)

          Text(record.date)
            .fontSize(12)
            .fontColor('#666666')
            .margin({ top: 4 })
            .alignSelf(ItemAlign.Start)
        }
        .layoutWeight(1)
        .alignItems(HorizontalAlign.Start)

        Button() {
          Image($r('app.media.icon_settings'))
            .width(16)
            .height(16)
            .fillColor('#CCCCCC')
        }
        .width(32)
        .height(32)
        .backgroundColor(Color.Transparent)
        .onClick(() => {
          console.info('æ›´å¤šæ“ä½œ');
        })
      }
      .width('100%')
      .alignItems(VerticalAlign.Top)

      if (record.content) {
        Text(record.content)
          .fontSize(14)
          .fontColor('#666666')
          .margin({ top: 12 })
          .maxLines(3)
          .textOverflow({ overflow: TextOverflow.Ellipsis })
          .alignSelf(ItemAlign.Start)
      }

      if (record.tags.length > 0) {
        Row() {
          ForEach(record.tags, (tag: string) => {
            Text(tag)
              .fontSize(10)
              .fontColor('#FF6B35')
              .backgroundColor('#FFF5F0')
              .padding({ left: 8, right: 8, top: 4, bottom: 4 })
              .borderRadius(12)
              .margin({ right: 8 })
          })
        }
        .width('100%')
        .margin({ top: 12 })
      }
    }
    .width('100%')
    .padding(16)
    .backgroundColor(Color.White)
    .borderRadius(12)
    .margin({ bottom: 12 })
    .onClick(() => {
      console.info('æŸ¥çœ‹è®°å½•è¯¦æƒ…:', record.id);
    })
  }

  @Builder
  buildAddDialog() {
    Column() {
      Text('æ·»åŠ æ–°è®°å½•')
        .fontSize(18)
        .fontWeight(FontWeight.Medium)
        .fontColor('#333333')
        .margin({ bottom: 24 })

      // è®°å½•ç±»å‹é€‰æ‹©
      Text('è®°å½•ç±»å‹')
        .fontSize(14)
        .fontColor('#333333')
        .alignSelf(ItemAlign.Start)
        .margin({ bottom: 12 })

      Row() {
        this.buildTypeOption('idea', 'ğŸ’¡', 'ç¤¼ç‰©æƒ³æ³•')
        this.buildTypeOption('date', 'ğŸ“…', 'é‡è¦æ—¥æœŸ')
        this.buildTypeOption('budget', 'ğŸ’°', 'é¢„ç®—è®°å½•')
        this.buildTypeOption('shopping', 'ğŸ›’', 'è´­ä¹°æ¸…å•')
      }
      .width('100%')
      .justifyContent(FlexAlign.SpaceBetween)
      .margin({ bottom: 20 })

      // æ ‡é¢˜è¾“å…¥
      Text('æ ‡é¢˜')
        .fontSize(14)
        .fontColor('#333333')
        .alignSelf(ItemAlign.Start)
        .margin({ bottom: 8 })

      TextInput({ placeholder: 'è¯·è¾“å…¥æ ‡é¢˜' })
        .width('100%')
        .height(40)
        .backgroundColor('#F8F9FA')
        .borderRadius(8)
        .padding({ left: 12, right: 12 })
        .onChange((value: string) => {
          this.newRecordTitle = value;
        })
        .margin({ bottom: 16 })

      // å†…å®¹è¾“å…¥
      Text('å†…å®¹')
        .fontSize(14)
        .fontColor('#333333')
        .alignSelf(ItemAlign.Start)
        .margin({ bottom: 8 })

      TextArea({ placeholder: 'è¯·è¾“å…¥è¯¦ç»†å†…å®¹...' })
        .width('100%')
        .height(100)
        .backgroundColor('#F8F9FA')
        .borderRadius(8)
        .padding(12)
        .onChange((value: string) => {
          this.newRecordContent = value;
        })
        .margin({ bottom: 16 })

      // æ ‡ç­¾é€‰æ‹©
      Text('æ ‡ç­¾')
        .fontSize(14)
        .fontColor('#333333')
        .alignSelf(ItemAlign.Start)
        .margin({ bottom: 8 })

      Flex({ wrap: FlexWrap.Wrap }) {
        ForEach(this.availableTags, (tag: string) => {
          Text(tag)
            .fontSize(12)
            .fontColor(this.selectedTags.includes(tag) ? Color.White : '#666666')
            .backgroundColor(this.selectedTags.includes(tag) ? '#FF6B35' : '#F0F0F0')
            .padding({ left: 12, right: 12, top: 6, bottom: 6 })
            .borderRadius(16)
            .margin({ right: 8, bottom: 8 })
            .onClick(() => {
              this.toggleTag(tag);
            })
        })
      }
      .width('100%')
      .margin({ bottom: 24 })

      // åº•éƒ¨æŒ‰é’®
      Row() {
        Button('å–æ¶ˆ')
          .fontSize(16)
          .fontColor('#666666')
          .backgroundColor('#F0F0F0')
          .borderRadius(25)
          .layoutWeight(1)
          .height(50)
          .margin({ right: 8 })
          .onClick(() => {
            this.resetAddDialog();
          })

        Button('ä¿å­˜')
          .fontSize(16)
          .fontColor(Color.White)
          .backgroundColor('#FF6B35')
          .borderRadius(25)
          .layoutWeight(1)
          .height(50)
          .margin({ left: 8 })
          .onClick(() => {
            this.saveRecord();
          })
      }
      .width('100%')
    }
    .width('100%')
    .padding(20)
  }

  @Builder
  buildTypeOption(type: string, icon: string, title: string) {
    Column() {
      Text(icon)
        .fontSize(20)
        .margin({ bottom: 4 })

      Text(title)
        .fontSize(10)
        .fontColor(this.newRecordType === type ? '#FF6B35' : '#666666')
    }
    .width(70)
    .height(60)
    .justifyContent(FlexAlign.Center)
    .alignItems(HorizontalAlign.Center)
    .backgroundColor(this.newRecordType === type ? '#FFF5F0' : '#F8F9FA')
    .borderRadius(8)
    .border({
      width: 1,
      color: this.newRecordType === type ? '#FF6B35' : '#F0F0F0'
    })
    .onClick(() => {
      this.newRecordType = type;
    })
  }

  private getTypeIcon(type: string): string {
    switch (type) {
      case 'idea': return 'ğŸ’¡';
      case 'date': return 'ğŸ“…';
      case 'budget': return 'ğŸ’°';
      case 'shopping': return 'ğŸ›’';
      default: return 'ğŸ“';
    }
  }

  private quickAdd(type: string, title: string): void {
    this.newRecordType = type;
    this.newRecordTitle = title;
    this.showAddDialog = true;
  }

  private toggleTag(tag: string): void {
    const index = this.selectedTags.indexOf(tag);
    if (index > -1) {
      this.selectedTags.splice(index, 1);
    } else {
      this.selectedTags.push(tag);
    }
  }

  private saveRecord(): void {
    if (!this.newRecordTitle.trim()) {
      return;
    }

    const newRecord: QuickRecord = {
      id: Date.now().toString(),
      type: this.newRecordType,
      title: this.newRecordTitle,
      content: this.newRecordContent,
      date: new Date().toLocaleDateString(),
      tags: [...this.selectedTags]
    };

    this.records.unshift(newRecord);
    this.resetAddDialog();
  }

  private resetAddDialog(): void {
    this.showAddDialog = false;
    this.newRecordType = 'idea';
    this.newRecordTitle = '';
    this.newRecordContent = '';
    this.selectedTags = [];
  }

  private loadRecords(): void {
    // æ¨¡æ‹ŸåŠ è½½å·²æœ‰è®°å½•
    this.records = [
      {
        id: '1',
        type: 'idea',
        title: 'å¦ˆå¦ˆç”Ÿæ—¥ç¤¼ç‰©æƒ³æ³•',
        content: 'è€ƒè™‘ä¹°ä¸€å¥—æŠ¤è‚¤å“ï¼Œå¥¹æœ€è¿‘æ€»è¯´çš®è‚¤å¹²ç‡¥ã€‚æˆ–è€…ä¹°ä¸ªæŒ‰æ‘©æ¤…ï¼Œå¥¹å·¥ä½œå¤ªç´¯äº†ã€‚',
        date: '2024-01-15',
        tags: ['ç¤¼ç‰©æƒ³æ³•', 'ç”Ÿæ—¥']
      },
      {
        id: '2',
        type: 'budget',
        title: 'æƒ…äººèŠ‚é¢„ç®—',
        content: 'æ€»é¢„ç®—500å…ƒï¼šé²œèŠ±100å…ƒï¼Œæ™šé¤200å…ƒï¼Œå°ç¤¼ç‰©200å…ƒ',
        date: '2024-01-10',
        tags: ['é¢„ç®—è®°å½•', 'æƒ…äººèŠ‚']
      }
    ];
  }
}